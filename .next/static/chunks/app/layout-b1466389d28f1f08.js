(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{9444:(e,t,s)=>{Promise.resolve().then(s.bind(s,8767)),Promise.resolve().then(s.bind(s,4073)),Promise.resolve().then(s.bind(s,7752)),Promise.resolve().then(s.bind(s,5906)),Promise.resolve().then(s.bind(s,9435)),Promise.resolve().then(s.bind(s,2009)),Promise.resolve().then(s.bind(s,7583)),Promise.resolve().then(s.bind(s,9543)),Promise.resolve().then(s.bind(s,7885)),Promise.resolve().then(s.bind(s,7695)),Promise.resolve().then(s.bind(s,3233)),Promise.resolve().then(s.bind(s,5478)),Promise.resolve().then(s.bind(s,350)),Promise.resolve().then(s.bind(s,6273)),Promise.resolve().then(s.t.bind(s,5356,23)),Promise.resolve().then(s.t.bind(s,347,23)),Promise.resolve().then(s.bind(s,6941)),Promise.resolve().then(s.bind(s,887))},6941:(e,t,s)=>{"use strict";s.d(t,{PWAManager:()=>h});var i={};s.r(i);var n=s(5155),a=s(2115),r=s(6675),o=s(4450),l=s(4857);function c(){let[e,t]=(0,a.useState)(null),[s,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[v,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{f(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")),u("standalone"in window.navigator&&window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches),p(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document);let e=e=>{e.preventDefault(),t(e),setTimeout(()=>{c(!0)},3e3)},s=()=>{console.log("[PWA] App installed successfully"),t(null),c(!1),u(!0),"undefined"!=typeof gtag&&gtag("event","pwa_installed",{event_category:"PWA",event_label:"Install Success"})};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",s),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",s)}},[]);let h=async()=>{if(e)try{await e.prompt();let{outcome:s}=await e.userChoice;"accepted"===s?console.log("[PWA] User accepted the install prompt"):console.log("[PWA] User dismissed the install prompt"),t(null),c(!1),"undefined"!=typeof gtag&&gtag("event","pwa_install_prompt",{event_category:"PWA",event_label:s})}catch(e){console.error("[PWA] Error showing install prompt:",e)}};return d||v||sessionStorage.getItem("pwa-install-dismissed")||!e&&!m?null:(0,n.jsx)("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:w-96",children:(0,n.jsx)(o.Zp,{className:"p-4 shadow-lg border-blue-200 bg-blue-50",children:(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(i.DevicePhoneMobileIcon,{className:"h-6 w-6 text-blue-600"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Install OpenRelief"}),(0,n.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Get instant access to emergency coordination features, even offline"}),(0,n.jsxs)("div",{className:"mt-3 flex space-x-2",children:[e?(0,n.jsxs)(r.$,{onClick:h,size:"sm",className:"flex-1",children:[(0,n.jsx)(l.A,{className:"h-3 w-3 mr-1"}),"Install"]}):m?(0,n.jsxs)(r.$,{onClick:()=>{c(!1);let e=document.createElement("div");e.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",e.innerHTML='\n      <div class="bg-white rounded-lg p-6 max-w-md w-full">\n        <h3 class="text-lg font-semibold mb-4">Install OpenRelief on iOS</h3>\n        <div class="space-y-3 text-sm text-gray-600">\n          <p>Follow these steps to install OpenRelief on your iOS device:</p>\n          <ol class="list-decimal list-inside space-y-2">\n            <li>Tap the Share button <span class="inline-block">⎋</span> at the bottom of the screen</li>\n            <li>Scroll down and tap "Add to Home Screen"</li>\n            <li>Tap "Add" to confirm the installation</li>\n          </ol>\n          <p class="text-xs text-gray-500 mt-4">This will add OpenRelief to your home screen for easy access.</p>\n        </div>\n        <button onclick="this.closest(\'.fixed\').remove()" class="mt-4 w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">\n          Got it\n        </button>\n      </div>\n    ',document.body.appendChild(e),"undefined"!=typeof gtag&&gtag("event","pwa_ios_instructions",{event_category:"PWA",event_label:"iOS Instructions Shown"})},size:"sm",className:"flex-1",children:[(0,n.jsx)(l.A,{className:"h-3 w-3 mr-1"}),"Install"]}):null,(0,n.jsx)(r.$,{onClick:()=>{c(!1),sessionStorage.setItem("pwa-install-dismissed","true"),"undefined"!=typeof gtag&&gtag("event","pwa_install_dismissed",{event_category:"PWA",event_label:"Banner Dismissed"})},size:"sm",variant:"ghost",className:"px-2",children:(0,n.jsx)(i.XMarkIcon,{className:"h-3 w-3"})})]})]})]})})})}var d=s(6782),u=s(9233),m=s(5843),p=s(7358);async function v(e){try{var t,s;if(!(await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e.endpoint,keys:{p256dh:null===(t=e.toJSON().keys)||void 0===t?void 0:t.p256dh,auth:null===(s=e.toJSON().keys)||void 0===s?void 0:s.auth}})})).ok)throw Error("Failed to send subscription to server")}catch(e){console.error("[Push] Failed to send subscription to server:",e)}}async function f(e){try{if(!(await fetch("/api/push/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e.endpoint})})).ok)throw Error("Failed to remove subscription from server")}catch(e){console.error("[Push] Failed to remove subscription from server:",e)}}function h(e){let{children:t}=e,{isOnline:s,isOffline:i,lastOnlineTime:r}=(0,d.M)(),{requestPermission:o}=function(){let[e,t]=(0,a.useState)(!1),[s,i]=(0,a.useState)("default"),[n,r]=(0,a.useState)(null),[o,l]=(0,a.useState)([]);(0,a.useEffect)(()=>((()=>{let e="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;t(e),e&&(i(Notification.permission),y())})(),"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then(e=>{e.addEventListener("change",()=>{i(e.state)})}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",c),()=>{"serviceWorker"in navigator&&navigator.serviceWorker.removeEventListener("message",c)}),[]);let c=(0,a.useCallback)(e=>{if(e.data&&"PUSH_NOTIFICATION"===e.data.type){let t=(0,m._)((0,u._)({id:"".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))},e.data.notification),{timestamp:Date.now(),read:!1});l(e=>[t,...e]),_([t,...o])}},[o]),d=(0,a.useCallback)(async()=>{if(!e)throw Error("Push notifications are not supported");try{let e=await Notification.requestPermission();return i(e),"granted"===e&&await h(),e}catch(e){throw console.error("[Push] Failed to request permission:",e),e}},[e]),h=(0,a.useCallback)(async()=>{if(!e)throw Error("Push notifications are not supported");try{let e=await navigator.serviceWorker.ready,t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),s=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}(p.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY)});return r(t),await v(t),t}catch(e){throw console.error("[Push] Failed to subscribe:",e),e}},[e]),g=(0,a.useCallback)(async()=>{if(n)try{await n.unsubscribe(),r(null),await f(n)}catch(e){console.error("[Push] Failed to unsubscribe:",e)}},[n]),x=(0,a.useCallback)(async(t,i,n)=>{if(!e||"granted"!==s)throw Error("Push notifications are not permitted");try{var a;let e=await navigator.serviceWorker.ready;null===(a=e.active)||void 0===a||a.postMessage({type:"SHOW_NOTIFICATION",notification:{title:t,body:i,icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",tag:"test",data:n,actions:[{action:"view",title:"View"},{action:"dismiss",title:"Dismiss"}]}})}catch(e){throw console.error("[Push] Failed to send test notification:",e),e}},[e,s]),b=(0,a.useCallback)(e=>{l(t=>t.map(t=>t.id===e?(0,m._)((0,u._)({},t),{read:!0}):t)),_(o.map(t=>t.id===e?(0,m._)((0,u._)({},t),{read:!0}):t))},[o]),w=(0,a.useCallback)(()=>{l([]),localStorage.removeItem("openrelief-notifications")},[]),y=(0,a.useCallback)(()=>{try{let e=localStorage.getItem("openrelief-notifications");if(e){let t=JSON.parse(e);l(t)}}catch(e){console.error("[Push] Failed to load notifications:",e)}},[]),_=(0,a.useCallback)(e=>{try{localStorage.setItem("openrelief-notifications",JSON.stringify(e))}catch(e){console.error("[Push] Failed to store notifications:",e)}},[]),N=(0,a.useCallback)(async t=>{if(!e||"granted"!==s)throw Error("Push notifications are not permitted");try{var i;let e=await navigator.serviceWorker.ready,s={title:"\uD83D\uDEA8 ".concat(t.severity.toUpperCase()," Emergency Alert"),body:t.description,icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",tag:"emergency-".concat(t.type),data:{type:"emergency",emergency:t,priority:"critical"===t.severity?"high":"normal"},actions:[{action:"view",title:"View Details",icon:"/icons/action-view.png"},{action:"respond",title:"I Can Help",icon:"/icons/action-help.png"},{action:"dismiss",title:"Dismiss",icon:"/icons/action-dismiss.png"}],requireInteraction:"critical"===t.severity,vibrate:"critical"===t.severity?[500,200,500,200,500,200,500]:[200,100,200]};null===(i=e.active)||void 0===i||i.postMessage({type:"SHOW_NOTIFICATION",notification:s})}catch(e){throw console.error("[Push] Failed to send emergency alert:",e),e}},[e,s]);return{isSupported:e,permission:s,subscription:n,notifications:o,requestPermission:d,subscribeToPush:h,unsubscribeFromPush:g,sendTestNotification:x,sendEmergencyAlert:N,markAsRead:b,clearNotifications:w,unreadCount:o.filter(e=>!e.read).length}}(),[l,h]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[PWA] Service Worker registered:",e),b(!0),e.addEventListener("updatefound",()=>{let t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&w()})})}).catch(e=>{console.error("[PWA] Service Worker registration failed:",e)});let e=()=>{"Notification"in window&&"default"===Notification.permission&&setTimeout(()=>{o().catch(()=>{})},5e3),document.removeEventListener("click",e),document.removeEventListener("touchstart",e)};return document.addEventListener("click",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e)}},[o]),(0,a.useEffect)(()=>{if(i){let e=setTimeout(()=>{h(!0)},1e4);return()=>clearTimeout(e)}h(!1)},[i]);let w=()=>{confirm("A new version of OpenRelief is available. Would you like to update?")&&"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{var t;null===(t=e.waiting)||void 0===t||t.postMessage({type:"SKIP_WAITING"})})};return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsx)(c,{}),(0,n.jsx)(g,{}),l&&(0,n.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-red-600 text-white p-3 text-center",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"⚠️"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"You're currently offline. Emergency features remain available."}),r&&(0,n.jsxs)("span",{className:"text-xs opacity-75",children:["Last online: ",r.toLocaleTimeString()]})]}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"text-white hover:text-gray-200 p-1","aria-label":"Dismiss",children:"\xd7"})]})}),!x&&(0,n.jsx)("div",{className:"fixed bottom-20 left-4 right-4 z-40 bg-yellow-100 border border-yellow-400 text-yellow-800 p-3 rounded-lg text-sm",children:(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("span",{children:"⚡ OpenRelief is loading offline capabilities..."})})})]})}function g(){let{isOnline:e,isOffline:t,connectionType:s,effectiveType:i}=(0,d.M)(),[r,o]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=()=>{o(!0),setTimeout(()=>o(!1),3e3)};return window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}},[]),r)?(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,n.jsx)("div",{className:"px-3 py-2 rounded-lg shadow-lg text-white text-sm font-medium ".concat(e?"bg-green-600":"bg-red-600"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{children:e?"\uD83D\uDFE2":"\uD83D\uDD34"}),(0,n.jsx)("span",{children:e?"Online":"Offline"}),s&&(0,n.jsxs)("span",{className:"text-xs opacity-75",children:["(",s," ",i&&"• ".concat(i),")"]})]})})}):null}},887:(e,t,s)=>{"use strict";s.d(t,{Toaster:()=>T});var i=s(9233),n=s(5843),a=s(2175),r=s(5155),o=s(2115),l=s(6421),c=s(1027),d=s(767),u=s(9143);let m=l.Kq,p=l.LM,v=(0,c.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),f=o.forwardRef((e,t)=>{var{className:s,variant:n}=e,o=(0,a._)(e,["className","variant"]);return(0,r.jsx)(l.bL,(0,i._)({ref:t,className:(0,u.cn)(v({variant:n}),s)},o))});f.displayName=l.bL.displayName,o.forwardRef((e,t)=>{var{className:s}=e,n=(0,a._)(e,["className"]);return(0,r.jsx)(l.rc,(0,i._)({ref:t,className:(0,u.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s)},n))}).displayName=l.rc.displayName;let h=o.forwardRef((e,t)=>{var{className:s}=e,o=(0,a._)(e,["className"]);return(0,r.jsx)(l.bm,(0,n._)((0,i._)({ref:t,className:(0,u.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":""},o),{children:(0,r.jsx)(d.A,{className:"h-4 w-4"})}))});h.displayName=l.bm.displayName;let g=o.forwardRef((e,t)=>{var{className:s}=e,n=(0,a._)(e,["className"]);return(0,r.jsx)(l.hE,(0,i._)({ref:t,className:(0,u.cn)("text-sm font-semibold",s)},n))});g.displayName=l.hE.displayName;let x=o.forwardRef((e,t)=>{var{className:s}=e,n=(0,a._)(e,["className"]);return(0,r.jsx)(l.VY,(0,i._)({ref:t,className:(0,u.cn)("text-sm opacity-90",s)},n))});x.displayName=l.VY.displayName;var b=s(616),w=s(2202);let y=0,_=new Map,N=e=>{if(_.has(e))return;let t=setTimeout(()=>{_.delete(e),E({type:"REMOVE_TOAST",toastId:e})},1e6);_.set(e,t)},S=(e,t)=>{switch(t.type){case"ADD_TOAST":return(0,n._)((0,i._)({},e),{toasts:[t.toast,...e.toasts].slice(0,1)});case"UPDATE_TOAST":return(0,n._)((0,i._)({},e),{toasts:e.toasts.map(e=>e.id===t.toast.id?(0,i._)({},e,t.toast):e)});case"DISMISS_TOAST":{let{toastId:s}=t;return s?N(s):e.toasts.forEach(e=>{N(e.id)}),(0,n._)((0,i._)({},e),{toasts:e.toasts.map(e=>e.id===s||void 0===s?(0,n._)((0,i._)({},e),{open:!1}):e)})}case"REMOVE_TOAST":if(void 0===t.toastId)return(0,n._)((0,i._)({},e),{toasts:[]});return(0,n._)((0,i._)({},e),{toasts:e.toasts.filter(e=>e.id!==t.toastId)})}},P=[],j={toasts:[]};function E(e){j=S(j,e),P.forEach(e=>{e(j)})}function k(e){var t=(0,b._)({},(0,w._)(e));let s=(y=(y+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>E({type:"DISMISS_TOAST",toastId:s});return E({type:"ADD_TOAST",toast:(0,n._)((0,i._)({},t),{id:s,open:!0,onOpenChange:e=>{e||a()}})}),{id:s,dismiss:a,update:e=>E({type:"UPDATE_TOAST",toast:(0,n._)((0,i._)({},e),{id:s})})}}function T(){let{toasts:e}=function(){let[e,t]=o.useState(j);return o.useEffect(()=>(P.push(t),()=>{let e=P.indexOf(t);e>-1&&P.splice(e,1)}),[e]),(0,n._)((0,i._)({},e),{toast:k,dismiss:e=>E({type:"DISMISS_TOAST",toastId:e})})}();return(0,r.jsxs)(m,{children:[e.map(function(e){var{id:t,title:s,description:o,action:l}=e,c=(0,a._)(e,["id","title","description","action"]);return(0,r.jsxs)(f,(0,n._)((0,i._)({},c),{children:[(0,r.jsxs)("div",{className:"grid gap-1",children:[s&&(0,r.jsx)(g,{children:s}),o&&(0,r.jsx)(x,{children:o})]}),l,(0,r.jsx)(h,{})]}),t)}),(0,r.jsx)(p,{})]})}},347:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[444,76,96,358],()=>t(9444)),_N_E=e.O()}]);