(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{3322:(e,t,s)=>{Promise.resolve().then(s.bind(s,9274))},9274:(e,t,s)=>{"use strict";s.d(t,{PWAStatus:()=>A});var a=s(5155),n=s(2115),r=s(4450),i=s(6675),c=s(9233),l=s(5843);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}async getCacheInfo(){let e=await caches.keys(),t=[];for(let s of e){let e=await caches.open(s),a=await e.keys(),n=0;for(let t of a.slice(0,10)){let s=await e.match(t);if(s){let e=s.clone();n+=(await e.arrayBuffer()).byteLength}}let r=Math.round(n/Math.min(a.length,10)*a.length);t.push({name:s,size:r,entries:a.length,lastModified:new Date})}return t}async clearCache(e){if(e)await caches.delete(e);else{let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}}async preloadCriticalAssets(){let e=await caches.open(this.cacheNames.static);try{await e.addAll(["/","/offline","/offline/emergency","/manifest.json","/icons/icon-192x192.png","/icons/icon-512x512.png"].map(e=>new Request(e,{cache:"no-cache"}))),console.log("[PWA] Critical assets preloaded successfully")}catch(e){console.error("[PWA] Failed to preload critical assets:",e)}}async estimateStorageUsage(){if("storage"in navigator&&"estimate"in navigator.storage){let e=await navigator.storage.estimate();return{used:Number(e.usage)||0,quota:Number(e.quota)||0,percentage:(Number(e.usage)||0)/(Number(e.quota)||1)*100}}return{used:0,quota:0,percentage:0}}constructor(){this.cacheNames={static:"openrelief-static-v2.0.0",dynamic:"openrelief-dynamic-v2.0.0",emergency:"openrelief-emergency-v2.0.0",offline:"openrelief-offline-v2.0.0"}}}class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}async initDB(){if(!this.db)return new Promise((e,t)=>{let s=indexedDB.open("OpenReliefOffline",2);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("actions")){let e=t.createObjectStore("actions",{keyPath:"id"});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1}),e.createIndex("synced","synced",{unique:!1})}if(!t.objectStoreNames.contains("emergencyData")){let e=t.createObjectStore("emergencyData",{keyPath:"id"});e.createIndex("type","type",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"key"})}})}async saveAction(e){return await this.initDB(),new Promise((t,s)=>{let a=this.db.transaction(["actions"],"readwrite").objectStore("actions").add(e);a.onerror=()=>s(a.error),a.onsuccess=()=>t()})}async getActions(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await this.initDB(),new Promise((s,a)=>{let n=this.db.transaction(["actions"],"readonly").objectStore("actions").getAll();n.onerror=()=>a(n.error),n.onsuccess=()=>{let a=n.result;e&&(a=a.filter(t=>t.type===e)),s(a=a.filter(e=>e.synced===t))}})}async markActionSynced(e){return await this.initDB(),new Promise((t,s)=>{let a=this.db.transaction(["actions"],"readwrite").objectStore("actions"),n=a.get(e);n.onerror=()=>s(n.error),n.onsuccess=()=>{let e=n.result;if(e){e.synced=!0;let n=a.put(e);n.onerror=()=>s(n.error),n.onsuccess=()=>t()}}})}async saveEmergencyData(e){return await this.initDB(),new Promise((t,s)=>{let a=this.db.transaction(["emergencyData"],"readwrite").objectStore("emergencyData").put((0,l._)((0,c._)({},e),{id:"emergency_".concat(Date.now()),timestamp:Date.now()}));a.onerror=()=>s(a.error),a.onsuccess=()=>t()})}async getEmergencyData(e){return await this.initDB(),new Promise((t,s)=>{let a=this.db.transaction(["emergencyData"],"readonly").objectStore("emergencyData").getAll();a.onerror=()=>s(a.error),a.onsuccess=()=>{let s=a.result;e&&(s=s.filter(t=>t.type===e)),t(s)}})}constructor(){this.db=null}}class m{static isOnline(){return navigator.onLine}static getConnectionType(){if("connection"in navigator){let e=navigator.connection;return(null==e?void 0:e.effectiveType)||(null==e?void 0:e.type)||null}return null}static async testConnectivity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/api/health";try{return(await fetch(e,{cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok}catch(e){return!1}}static async getNetworkQuality(){if("connection"in navigator){let e=navigator.connection;return{effectiveType:e.effectiveType||"unknown",downlink:e.downlink||0,rtt:e.rtt||0,saveData:e.saveData||!1}}return{effectiveType:"unknown",downlink:0,rtt:0,saveData:!1}}}class x{static async measurePageLoad(){return new Promise(e=>{let t=performance.getEntriesByType("navigation")[0],s={domContentLoaded:t.domContentLoadedEventEnd-t.domContentLoadedEventStart,loadComplete:t.loadEventEnd-t.loadEventStart};if("PerformanceObserver"in window)try{new PerformanceObserver(t=>{for(let e of t.getEntries())"first-contentful-paint"===e.name?s.firstContentfulPaint=e.startTime:"largest-contentful-paint"===e.name&&(s.largestContentfulPaint=e.startTime);e(s)}).observe({entryTypes:["paint","largest-contentful-paint"]}),setTimeout(()=>e(s),5e3)}catch(t){e(s)}else e(s)})}static async getCacheHitRate(){try{let e=performance.getEntriesByType("navigation")[0],t=e.transferSize||0,s=e.encodedBodySize||0;if(0===t&&0===s)return 100;if(0===s)return 0;return Math.max(0,100-t/s*100)}catch(e){return 0}}}function g(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function u(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):"".concat(t,"s")}var h=s(1773),f=s(5996),y=s(1836),p=s(7581),v=s(1476),j=s(9993),N=s(6889),w=s(6745),b=s(7564),C=s(878);function A(){var e;let[t,s]=(0,n.useState)(!0),[c,l]=(0,n.useState)([]),[A,S]=(0,n.useState)({used:0,quota:0,percentage:0}),[P,k]=(0,n.useState)({}),[D,E]=(0,n.useState)({}),[L,B]=(0,n.useState)([]),[T,M]=(0,n.useState)(!1);(0,n.useEffect)(()=>{I();let e=()=>s(!0),t=()=>s(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let I=async()=>{try{let e=o.getInstance(),t=await e.getCacheInfo();l(t);let s=await e.estimateStorageUsage();S(s);let a=await m.getNetworkQuality();k(a);let n=await x.measurePageLoad();E(n);let r=d.getInstance(),i=await r.getActions();B(i.filter(e=>!e.synced))}catch(e){console.error("Failed to load PWA status:",e)}},O=async()=>{M(!0),await I(),M(!1)},q=async e=>{try{let t=o.getInstance();await t.clearCache(e),await I()}catch(e){console.error("Failed to clear cache:",e)}},_=async()=>{try{let e=o.getInstance();await e.preloadCriticalAssets(),await I()}catch(e){console.error("Failed to preload assets:",e)}},z=e=>e<1e3?{grade:"A",color:"text-green-600"}:e<2e3?{grade:"B",color:"text-yellow-600"}:e<3e3?{grade:"C",color:"text-orange-600"}:{grade:"D",color:"text-red-600"};return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"PWA Status"}),(0,a.jsxs)(i.$,{onClick:O,disabled:T,variant:"outline",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2 ".concat(T?"animate-spin":"")}),"Refresh"]})]}),(0,a.jsxs)(r.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[t?(0,a.jsx)(f.A,{className:"h-6 w-6 text-green-600"}):(0,a.jsx)(y.A,{className:"h-6 w-6 text-red-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Network Status"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Connection"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:t?"Online":"Offline"})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Effective Type"}),(0,a.jsx)("div",{className:"text-lg font-medium ".concat((e=>{switch(e){case"4g":return"text-green-600";case"3g":return"text-yellow-600";case"2g":return"text-orange-600";case"slow-2g":return"text-red-600";default:return"text-gray-600"}})(P.effectiveType)),children:(null===(e=P.effectiveType)||void 0===e?void 0:e.toUpperCase())||"Unknown"})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Downlink"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:P.downlink?"".concat(P.downlink," Mbps"):"Unknown"})]})]})]}),(0,a.jsxs)(r.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(p.A,{className:"h-6 w-6 text-blue-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Storage Status"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Storage Usage"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[g(A.used)," / ",g(A.quota)]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full ".concat(A.percentage>80?"bg-red-600":A.percentage>60?"bg-yellow-600":"bg-green-600"),style:{width:"".concat(Math.min(A.percentage,100),"%")}})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Queued Actions"}),(0,a.jsxs)("div",{className:"text-lg font-medium text-orange-600",children:[L.length," items"]})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Cache Entries"}),(0,a.jsxs)("div",{className:"text-lg font-medium",children:[c.reduce((e,t)=>e+t.entries,0)," items"]})]})]})]})]}),(0,a.jsxs)(r.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(v.A,{className:"h-6 w-6 text-purple-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Cache Status"})]}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(i.$,{onClick:_,size:"sm",variant:"outline",children:"Preload Assets"}),(0,a.jsxs)(i.$,{onClick:()=>q(),size:"sm",variant:"outline",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Clear All"]})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:c.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.entries," entries • ",g(e.size)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.lastModified.toLocaleTimeString()}),(0,a.jsx)(i.$,{onClick:()=>q(e.name),size:"sm",variant:"ghost",children:(0,a.jsx)(j.A,{className:"h-4 w-4"})})]})]},t))})]}),(0,a.jsxs)(r.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(w.A,{className:"h-6 w-6 text-green-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Performance"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Page Load Time"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-lg font-medium",children:D.loadComplete?u(D.loadComplete):"N/A"}),D.loadComplete&&(0,a.jsxs)("span",{className:"text-sm font-medium ".concat(z(D.loadComplete).color),children:["Grade ",z(D.loadComplete).grade]})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"DOM Content Loaded"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:D.domContentLoaded?u(D.domContentLoaded):"N/A"})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"First Contentful Paint"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:D.firstContentfulPaint?u(D.firstContentfulPaint):"N/A"})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Largest Contentful Paint"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:D.largestContentfulPaint?u(D.largestContentfulPaint):"N/A"})]})]})]}),L.length>0&&(0,a.jsxs)(r.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(N.A,{className:"h-6 w-6 text-orange-600"}),(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Queued Actions (",L.length,")"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:L.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.type}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.endpoint," • ",new Date(e.timestamp).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 text-orange-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-orange-600",children:"Pending"})]})]},t))}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(C.A,{className:"h-5 w-5 text-blue-600"}),(0,a.jsx)("p",{className:"text-sm text-blue-800",children:"These actions will be automatically synced when you regain internet connection."})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[76,96,358],()=>t(3322)),_N_E=e.O()}]);